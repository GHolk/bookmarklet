<!DOCTYPE html><html lang="zh_TW" prefix="og: http://ogp.me/ns#"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">

<title>gholk's bookmarklet and userscript</title>

<meta name="author" property="og:article:author" content="gholk">
<meta name="copyright" content="GPLv3+">
<meta name="generator" content="mark-dd">

<meta name="date" property="og:article:public_time" content="2023-01-20T12:28:42.366Z">
<meta name="keywords" property="og:article:tag" content="bookmarklet, javascript, tool, greasemonkey, user-script, data-url">
<meta name="description" property="og:description" content="GHolk 的小書籤、油猴腳本集合。
還包含一種完整網頁的 data-url，一種完整的小工具網頁可以收在書籤裡。">

<link rel="alternate" type="text/html" href="https://g0v.social/@gholk" title="在 fediverse 上討論" id="active-pub-thread">
<link rel="alternate" type="application/atom+xml" href="https://github.com/GHolk/bookmarklet/commits/master.atom">

<link rel="icon" type="image/png" href="../ext/icon.png">
<link rel="apple-touch-icon" type="image/png" href="../ext/icon.png">
<link rel="webmention" href="https://webmention.io/gholk.github.io/webmention">
<link rel="pingback" href="https://webmention.io/gholk.github.io/xmlrpc">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
img[alt="drag bookmarklet vedio"] {
  display: block;
  margin: auto; /* align center */
  border: solid 1px;
  height: 15em;
}
code {
  border: 1px solid;
  padding: 0 0.2em;
}
pre > code {
  display: block;
  padding: 0.8em;
}
</style></head>
<body>
<main>
<h1 id="gholk's-bookmarklet-and-userscript">gholk's bookmarklet and userscript</h1>
<p>GHolk 的小書籤、油猴腳本集合。
還包含一種完整網頁的 data-url，一種完整的小工具網頁可以收在書籤裡。</p>
<p>if you are in github.com,
please go to
<a href="//gholk.github.io/bookmarklet">github page of this repository</a>
or <a href="index.html">index.html</a>
to use drag drop to add bookmarklet,
because github disable bookmarklet in
README.md in github repository page.</p>
<h2 id="小書籤安裝方法">小書籤安裝方法</h2>
<p>長按標題的小書籤超連結，拖曳到書籤列即安裝完成；
點擊書籤列中的小書籤即可在當下頁面中執行。</p>
<img src="bookmarklet-add.gif" alt="drag bookmarklet vedio">




<h2 id="訂閱">訂閱</h2>
<p>懶得做 rss，請直接訂閱 <a href="https://github.com/GHolk/bookmarklet/commits/master.atom">github 自動依 git 歷史產生的 rss</a> ，
或直接 watch <a href="https://github.com/GHolk/bookmarklet">github repository</a> 用 email 收 github 通知。</p>
<h2 id="授權-license">授權 license</h2>
<p>若無指定，本頁面中所有腳本使用 <a href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3</a> 或其後續版本授權。</p>
<p>all scripts in this page/repository are licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3</a>.</p>
<h2 id="[youtube-clean-player]"><a href="javascript:void function () {const urlToPlayer={};urlToPlayer.youtube=function(location){const scan=location.search.match(/[&amp;\/\?]v=([^&amp;]*)/);const id=scan[1];return&quot;https://youtube.com/embed/&quot;+id};function openCleanWindow(url){window.open(url,&quot;clean youtube player&quot;,&quot;resizable&quot;)}function createButton(){const menuId=&quot;menu-container&quot;;const button=document.createElement(&quot;button&quot;);button.textContent=&quot;clean window&quot;;button.onclick=(()=>{const url=urlToPlayer.youtube(location);openCleanWindow(url)});document.getElementById(menuId).appendChild(button)}openCleanWindow(urlToPlayer.youtube(location));}()">youtube clean player</a></h2>
<p>play youtube video in clean window,
without locationbar, menubar, toolbar, statusbar.</p>
<h2 id="[custom-search]"><a href="javascript:void function () {const map={};map.set=function(alias,url,name){this[alias]={url:url,name:name}};map.createForm=function(key){const form=document.createElement(&quot;form&quot;);const search=this[key];form.action=search.url;form.target=&quot;_blank&quot;;const input=document.createElement(&quot;input&quot;);input.name=search.name;form.appendChild(input);return form};map.search=function(key,string){const form=this.createForm(key);form.querySelector(&quot;input&quot;).value=string;document.documentElement.appendChild(form);form.submit()};map.set(&quot;pttpedia&quot;,&quot;http://zh.pttpedia.wikia.com/wiki/特殊:搜索&quot;,&quot;query&quot;);function promptSearch(string){if(!string)string=prompt(&quot;custom search&quot;);const scan=string.match(/([^\s]+)\s(.*)$/);const key=scan[1];const value=scan[2];map.search(key,value)}promptSearch();}()">custom search</a></h2>
<h2 id="[jumper-translator]"><a href="javascript:void function () {var jumperTranslator={urlScheme:null,decode:decodeURIComponent,translate:function(url){const scan;if(scan=url.match(this.urlScheme)){return this.decode(scan[1])}else return null},modifyAnchor:function(anchor){const newUrl=this.translate(anchor.href);if(typeof newUrl==&quot;string&quot;)anchor.href=newUrl;return anchor},modifyAllAnchor:function(){for(const anchor of document.querySelectorAll(&quot;a&quot;)){this.modifyAnchor(anchor)}},promptUrlScheme:function(){const urlRegexpString=prompt(&quot;url scheme regexp&quot;);this.urlScheme=new RegExp(urlRegexpString)}};jumperTranslator.promptUrlScheme();}()">jumper translator</a></h2>
<p>redirector anchor url translator</p>
<h2 id="[generate-url-qrcode]"><a href="javascript:void function () {const url=window.location.href,qrcodeUrl=`http://chart.googleapis.com/chart?chs=150x150&amp;cht=qr&amp;chl=${url}`;window.open(qrcodeUrl);}()">generate url qrcode</a></h2>
<p>this bookmarklet will generate QR code image of current url,
and open in the new tab.</p>
<h2 id="[facebook-video-rotate]"><a href="javascript:void function () {function getRotateRatio(cssString){const scan=cssString.match(/rotate\((-?\d+(\.\d+)?)turn\)/);if(scan){return Number(scan[1])}return 0}document.querySelectorAll(&quot;div[role=presentation]&quot;).forEach(present=>{const container=present.parentNode;if(container.querySelector(&quot;video&quot;)){console.log(&quot;get video&quot;,container);const ratioNext=getRotateRatio(container.style.transform)-.25;container.style.transform=`rotate(${ratioNext}turn)`}});}()">facebook video rotate</a></h2>
<p>逆時針方向旋轉方向錯誤的 facebook 浮動影片視窗 90° 。</p>
<h2 id="[enable-select-contextmenu-小書籤版][enable-select-contextmenu.bookmarklet.js]"><a href="javascript:void function () {function stopEvent(event){event.stopImmediatePropagation()}const registFirst={capture:!0};window.addEventListener(&quot;contextmenu&quot;,stopEvent,registFirst),document.addEventListener(&quot;mousedown&quot;,stopEvent,registFirst),document.body.style.userSelect=&quot;text&quot;;}()">enable select contextmenu 小書籤版</a></h2>
<p>取消網頁中禁用右鍵與防止選取文字的功能。
有些網頁會禁止反白選取文字，或是禁止右鍵，
這個小書籤可以強制允許右鍵與選取文字，
但不處理禁用 f12 或 ctrl-c 的網頁。</p>
<h2 id="[enable-select-contextmenu-油猴腳本][enable-select-contextmenu.user.js]"><a href="enable-select-contextmenu.user.js">enable select contextmenu 油猴腳本</a></h2>
<p>同上，但是油猴腳本版本。
如果常用網站會鎖右鍵和選取文字，
直接把該網站加入到 user include 即可。</p>
<h2 id="[強制啟用貼上功能][force-enable-paste.user.js]"><a href="force-enable-paste.user.js">強制啟用貼上功能</a></h2>
<p>某些網站會封鎖貼上功能，也就不能用右鍵貼上或是中鍵貼上，
也不能用 ctrl-v 貼上。
目前碰到的是某些信用卡網站，逼你一定要用鍵盤輸入，比較安全。
這個腳本可以啟用貼上功能。
如果碰到更多網站，就自己加入吧。</p>
<h3 id="[強制啟用貼上功能小書籤版][force-enable-paste.bookmarklet.js]"><a href="javascript:void function () {setInterval(()=>{document.querySelectorAll(&quot;[onpaste]&quot;).forEach(node=>{node.onpaste=null}),document.body.onpaste&amp;&amp;(document.body.onpaste=null)},1e3);}()">強制啟用貼上功能小書籤版</a></h3>
<p>同上，不想裝油猴的可以用小書籤版。</p>
<h2 id="[facebook-image-downloader]"><a href="javascript:void function () {class GholkLib{constructor(){return this._constructor(...arguments)}_constructor(){}sleep(second){return new Promise(wake=>setTimeout(wake,1e3*second))}$(q,root=document){return root.querySelector(q)}$$(q,root=document){return Array.from(root.querySelectorAll(q))}create(name,parent){const node=document.createElement(name);return parent&amp;&amp;parent.appendChild(node),node}pipe(value,...fn){return fn.reduce((v,f)=>f(v),value)}bindr(object,thing,...args){return this.bind.call(object,thing,...args)}bind(thing,...args){let f;return(f=&quot;function&quot;==typeof thing?thing:object[thing]).bind(this,...args)}async keepTry(fn,interval){let result=fn();for(;!result;)await this.sleep(interval),result=fn();return result}defer(){const defer={};return defer.promise=new Promise((ok,reject)=>{defer.ok=ok,defer.reject=reject}),defer}defm(klass,name,fn){Object.defineProperty(klass.prototype,name,{value:fn,writable:!0,configurable:!0,enumerable:!1})}patch(){const{pipe:pipe,bindr:bindr}=this;this.defm(Object,&quot;bind&quot;,this.bind),this.defm(Object,&quot;pipe&quot;,function pipe(...fn){let value;switch(this.constructor){case String:case Number:case window.BigInt:case Boolean:case window.Symbol:value=this.valueOf();break;default:value=this}return pipe(value,...fn)}),this.defm(Object,&quot;toArray&quot;,function(){return Array.from(this)})}depatch(){for(const name of&quot;bind pipe toArray&quot;.split(&quot; &quot;))delete Object.prototype[name]}buttonClick({style:style,parent:parent=document.body,text:text,click:click}){const button=this.create(&quot;button&quot;,parent);button.textContent=text;return Object.assign(button.style,{position:&quot;fixed&quot;,bottom:0,right:0,margin:&quot;1em&quot;},style),button.onclick=click,button}download(url,name=Date.now().toString()){const a=this.create(&quot;a&quot;,document.body);a.href=url,a.download=name,a.click(),a.remove()}}class FacebookImageDownloader extends GholkLib{static run(){(new this).init()}init(){this.end=!1,this.url=null,this.showStopButton(),this.watch()}download(...args){return this.downloadFetch(...args)}async downloadFetch(url){const res=await fetch(url),blob=await res.blob(),blobUrl=URL.createObjectURL(blob);this.downloadBookmarklet(blobUrl),await this.sleep(.2),URL.revokeObjectURL(blobUrl)}downloadTridactyl(url){this.tri.messaging.message(&quot;download_background&quot;,&quot;downloadUrl&quot;,url,!1)}downloadBookmarklet(...args){super.download(...args)}showStopButton(){this.buttonClick({text:&quot;end image downloader&quot;,click:event=>{this.end=!0,event.target.remove()}})}async watch(){await this.keepTry(()=>{if(this.end)return!0;const url=window.location.href;if(url!=this.url){this.url=url;const image=this.$$(&quot;[role = main] img&quot;);0==image.length?alert(&quot;no image found&quot;):1==image.length?this.download(image[0].src):confirm(&quot;more than 1 image found, download all?&quot;)&amp;&amp;image.forEach(image=>this.download(image.src))}},.2)}static runTridactyl(){tri.FacebookImageDownloader||(tri.FacebookImageDownloader=FacebookImageDownloader),tri.FacebookImageDownloader.instance?(tri.FacebookImageDownloader.instance.end=!0,tri.FacebookImageDownloader.instance=null):(tri.FacebookImageDownloader.instance=new tri.FacebookImageDownloader,tri.FacebookImageDownloader.instance.init())}}FacebookImageDownloader.run();}()">facebook image downloader</a></h2>
<p>download images on facebook when viewing them.
when url change, this script will find the
image and download it with timestamp filename.</p>
<h2 id="[press-b-to-google]"><a href="press-b-to-google.user.js">press b to google</a></h2>
<p>靈感來自 <a href="https://blog.gslin.org/archives/2021/09/10/10312/%E6%94%B9%E5%AF%AB%E3%80%8Cpress-g-to-google-duckduckgo%E3%80%8D%E8%AE%93%E4%BB%96%E6%94%AF%E6%8F%B4-whoogle/">gslin 的 press g to google</a> 。
把搜尋引擎換成 duckduckgo 後，搜尋結果沒有 google 那麼好，
有時成果不是想要的，就會想直接換回用 google 搜尋。
gslin 就寫了一個在 duckduckgo 結果頁面上，
按鍵盤的 g 就會用同樣關鍵字以 google 搜尋的油猴腳本。
但因為 g 在 vimium 裡蠻常用到的，
主要就 <code>gg</code> 和 <code>G</code> 是捲動到頁首和頁尾，
所以我重寫了一個把 g 改成 b 的版本。</p>
<h2 id="[hackmd-scroll-flip]"><a href="javascript:void function () {if(document.querySelector(&quot;.reveal .slides&quot;)){const Reveal=unsafeWindow.Reveal;document.querySelector(&quot;.reveal&quot;).addEventListener(&quot;wheel&quot;,function(scroll){scroll.preventDefault(),scroll.deltaY>0?Reveal.next():Reveal.prev()},{passive:!1});const style=document.createElement(&quot;style&quot;);style.textContent=&quot;\n.reveal .slides ::selection {\n    background-color: yellow;\n    color: initial;\n}\n.reveal .slides ::-moz-selection {\n    background-color: yellow;\n    color: initial;\n}\n.reveal .slides {\n    cursor: url('data:image/cur;base64,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') 12.5 12.5, auto;\n}\n&quot;,document.body.appendChild(style)}}()">hackmd scroll flip</a></h2>
<p>make mouse scroll flip page in hackmd slide mode.
title is bookmarklet, below is grease monkey user.js:
<a href="hackmd-scroll-flip.user.js">hackmd-scroll-flip.user.js</a> .</p>
<h2 id="[moodle-backup]"><a href="javascript:void function () {class MoodleCrawler{constructor(){this.sleepInterval=3,this.domParser=new DOMParser,this.textDecoder=new TextDecoder(&quot;UTF-8&quot;)}async fetch(url){return await fetch(url,{credentials:&quot;same-origin&quot;})}async $fetch(url){const response=await this.fetch(url),html=await response.text();return this.domParser.parseFromString(html,&quot;text/html&quot;)}*extractAllCourseId(document){const anchorList=document.querySelectorAll(&quot;.block_course_list a&quot;);for(const anchor of anchorList){yield new URL(anchor.href).searchParams.get(&quot;id&quot;)}}extractTitle(document){return document.getElementById(&quot;logobox&quot;).textContent.trim()}*extractFolder(url){const fileList=this.$fetch(url).then(dom=>dom.querySelectorAll(&quot;.fp-filename-icon a&quot;));let finish=!1,index=0;for(;!finish;)yield fileList.then(anchorList=>{let anchor=null;return index<anchorList.length&amp;&amp;(anchor=anchorList[index],index++),index>=anchorList.length&amp;&amp;(finish=!0),{url:anchor.href}})}*extractByType(tr){const url=tr.querySelector(&quot;a&quot;).href;let description=tr.querySelector(&quot;td:last-child&quot;).textContent;description=description.trim(),url.includes(&quot;/mod/resource/view.php&quot;)?yield{url:url,description:description}:url.includes(&quot;/mod/folder/view.php&quot;)?yield*this.extractFolder(url):url.includes(&quot;/mod/page/view.php&quot;)||url.includes(&quot;/mod/url/view.php&quot;)?yield{url:url,description:description}:console.error(`unknown file type: ${url}`)}*extractAllFile(document){for(const tr of document.querySelectorAll(&quot;#region-main-box tr[class]&quot;))yield*this.extractByType(tr)}async $fetchCourseResource(id){const url=`https://moodle.ncku.edu.tw/course/resources.php?id=${id}`;return await this.$fetch(url)}sleep(second=this.sleepInterval){return new Promise(wake=>setTimeout(wake,1e3*second))}getLastCourseId(){return localStorage.getItem(&quot;moodle-backup-current-id&quot;)}setLastCourseId(id){localStorage.setItem(&quot;moodle-backup-current-id&quot;,id)}removeLastCourseId(){localStorage.removeItem(&quot;moodle-backup-current-id&quot;)}async run(){this.runInit();let alreadyDownload,lastCourseId=this.getLastCourseId();alreadyDownload=!!lastCourseId;for(const id of this.extractAllCourseId(document)){if(alreadyDownload){if(lastCourseId!=id)continue;alreadyDownload=!1}this.setLastCourseId(id);const resource=await this.$fetchCourseResource(id);this.extractTitle(resource);await this.sleep();for(let file of this.extractAllFile(resource))file&amp;&amp;file.then&amp;&amp;(file=await file),file&amp;&amp;(this.download(file.url),await this.sleep())}this.removeLastCourseId(),this.runDestruct()}runInit(){this.downloadInit(),this.preventExitInit()}runDestruct(){this.downloadDestruct(),this.preventExitDestruct()}isFirefox(){return navigator.userAgent.match(/firefox/i)}downloadInit(){const anchor=document.createElement(&quot;a&quot;);this.isFirefox()||anchor.setAttribute(&quot;download&quot;,&quot;&quot;),anchor.setAttribute(&quot;target&quot;,&quot;_blank&quot;),document.body.appendChild(anchor),this.downloadNode=anchor}download(url){this.downloadNode.href=url,this.downloadNode.click()}downloadDestruct(){this.downloadNode.remove(),this.downloadNode=null}preventExitInit(){window.onbeforeunload=this.preventExit}preventExit(closeEvent){return&quot;moodle backup is not finish, do you want to exit?&quot;}preventExitDestruct(){window.onbeforeunload=null}async bookmarkletPrompt(){let second=prompt(&quot;download file interval second:&quot;);this.assert(&quot;string&quot;==typeof second,&quot;user abrupt&quot;),second=Number(second),this.assert(second>0,&quot;second should be positive&quot;),this.sleepInterval=Number(second),await this.run(),alert(&quot;download finish&quot;)}assert(test,errorMessage,CustomError=Error){if(!test)throw new CustomError(errorMessage)}}class MoodleCrawlerDebug extends MoodleCrawler{constructor(){super(),this.sleepInterval=.5}extractTitle(document){const title=super.extractTitle(document);this.currentCourseTitle=title}download(url){console.log(this.currentCourseTitle,url)}}const moodleCrawler=new MoodleCrawler;moodleCrawler.bookmarkletPrompt();}()">moodle backup</a></h2>
<p>在 <a href="https://moodle.ncku.edu.tw">成功大學的 moodle</a> 首頁登入後，
點擊該書籤，能自動下載所有課程中教授上傳的講義。
畢竟 moodle 上的資料不會永遠留著，
畢業後還是下載到自己電腦裡比較安心。</p>
<p>事前建議先把瀏覽器對 pdf 檔的動作設成儲存而非開啟，
firefox: <em>偏好設定 &gt; 應用程式 &gt; 搜尋 pdf &gt; 動作 &gt; 儲存檔案</em> ，
chromium: <em>Settings &gt; Privacy and security &gt;
Content settings &gt; PDF documents &gt; Download</em> 。
另外 chromium 及 firefox 都建議設定預設下載的資料夾，
基本上就能全部自動下載，不會彈對話框。
有時一些檔案格式會無法直接下載，變成在新分頁開啟，
只能再右鍵另存新檔。</p>
<p>點擊書籤後會先彈出對話框要你輸入幾秒下載一個檔案，
建議是 1-3 秒，不要對計中的伺服器造成太大負擔；
輸入後就會開始一一下載。
如果要暫停或中斷，直接關掉分頁時會詢問是否要離開，
同時也會暫停不再下載新檔案。
若選擇停留就會繼續下載新檔案，確定離開就不會再下載新檔案；
下次再執行時會自動從上次下載到一半的課程繼續下載。</p>
<p>firefox 有個 bug，如果下載的檔案是純文字檔 txt，
會無法下載只會直接打開；
所以 firefox 的使用者我改用在新分頁開啟的形式，
防止原本 moodle 的頁面被結束掉。
chrome 好像會跳出大量下載的警告，記得勾允許。</p>
<h2 id="[screen-message]"><a href="data:text/html;base64,PGh0bWw+CjwhLS0KIyAgICAgc20uaHRtbAojICAgICBDb3B5cmlnaHQgKEMpIDIwMDYgLSAyMDEwIEpvYWNoaW0gQnJlaXRuZXIKIwojICAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQojICAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQojICAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgojICAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgojCiMgICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAojICAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgojICAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiMgICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiMKIyAgICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKIyAgICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKIyAgICAgRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxIFVTQQotLT4KPGhlYWQ+Cjx0aXRsZT5TY3JlZW4gbWVzc2FnZTwvdGl0bGU+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiN0ZXh0YXJlYSB7Cglwb3NpdGlvbjphYnNvbHV0ZTsKCXRvcDowcHg7CglsZWZ0OjBweDsKCXdpZHRoOjEwMCU7CgloZWlnaHQ6MTAwJTsKCWZvbnQtZmFtaWx5OiAgbW9ub3NwYWNlLCBzYW5zOwoJcGFkZGluZzowcHg7CgltYXJnaW46MHB4OwoJYm9yZGVyOjBweDsKCXRleHQtYWxpZ246Y2VudGVyOwoJb3ZlcmZsb3c6aGlkZGVuOwoJcmVzaXplOm5vbmU7CgkvKgoJVGhpcyB1c2VkIHRvIGJlIGhlcmUuIE5vdCBzdXJlIHdoeSwgYnV0IGV2ZW50dWFsbHksCglpdCBicm9rZSBGaXJlZm94IChuZXdsaW5lcyBub3Qgd3JhcHBpbmcgbGluZXMpCgl3aGl0ZS1zcGFjZTpub3dyYXA7CgkqLwp9CgovKiBkaXNhYmxlIGZvY3VzIGJvcmRlciBhdCBDaHJvbWUgKi8KI3RleHRhcmVhOmZvY3VzIHsKCW91dGxpbmU6IG5vbmU7Cn0KCiN0ZXN0IHsKCXBvc2l0aW9uOmFic29sdXRlOwoJdmlzaWJpbGl0eTpoaWRkZW47Cgl0b3A6MHB4OwoJbGVmdDowcHg7Cglmb250LXNpemU6MzBweDsKCXdoaXRlLXNwYWNlOnByZTsKCWZvbnQtZmFtaWx5OiBtb25vc3BhY2UsIHNhbnM7Cglib3JkZXI6MHB4OwoJcGFkZGluZzowLjFlbTsKCW1hcmdpbjowcHg7Cn0KI2Fib3V0IHsKCXBvc2l0aW9uOmFic29sdXRlOwoJd2lkdGg6MjBlbTsKCXRvcDozMHB4OwoJcmlnaHQ6MzBweDsKCWJhY2tncm91bmQtY29sb3I6Z3JheTsKCXBhZGRpbmc6MWVtOwp9Cgo8L3N0eWxlPgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+Cm9wYWNpdHkgPSAxMDA7CmZ1bmN0aW9uIGFkanVzdCgpIHsKCXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRleHRhcmVhIik7Cgl0ZXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRlc3QiKTsKCQoJdGVzdC50ZXh0Q29udGVudD10YS52YWx1ZTsKCS8vIE90aGVyd2lzZSwgdGhlIG5ld2xpbmUgd291bGQgbm90IGJlIGNvdW50ZWQuCglpZiAodGEudmFsdWVbdGEudmFsdWUubGVuZ3RoLTFdID09ICJcbiIpIHsKCQl0ZXN0LmlubmVySFRNTCArPSAnLic7Cgl9CgoJcmF0aW9YID0gKHdpbmRvdy5pbm5lcldpZHRoKSAvIHRlc3Qub2Zmc2V0V2lkdGg7CglyYXRpb1kgPSAod2luZG93LmlubmVySGVpZ2h0KSAvIHRlc3Qub2Zmc2V0SGVpZ2h0OwoJcmF0aW8gPSBNYXRoLm1pbihyYXRpb1gscmF0aW9ZKTsKCWZvbnRTaXplID0gTWF0aC5mbG9vcigzMCAqIHJhdGlvKSArICJweCIKCXRhLnN0eWxlLmZvbnRTaXplID0gZm9udFNpemU7CgluZXdIZWlnaHQgPSBNYXRoLmNlaWwodGVzdC5vZmZzZXRIZWlnaHQgKiByYXRpbyk7CgkvL3RhLnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodCArICJweCI7CgkvL3RhLnN0eWxlLnRvcCA9IE1hdGguZmxvb3IoKHdpbmRvdy5pbm5lckhlaWdodCAtIG5ld0hlaWdodCkvMikgKyAicHgiOwoJdGEuc3R5bGUucGFkZGluZ1RvcCA9IE1hdGguZmxvb3IoKHdpbmRvdy5pbm5lckhlaWdodCAtIG5ld0hlaWdodCkvMikgKyAicHgiOwoJdGEuc3R5bGUucGFkZGluZ0JvdHRvbSA9IE1hdGguZmxvb3IoKHdpbmRvdy5pbm5lckhlaWdodCAtIG5ld0hlaWdodCkvMikgKyAicHgiOwoJbmV3V2lkdGggPSBNYXRoLmNlaWwodGVzdC5vZmZzZXRXaWR0aCAqIHJhdGlvKTsKCS8vdGEuc3R5bGUud2lkdGggPSBuZXdXaWR0aCArICJweCI7Cgl0YS5zdHlsZS5wYWRkaW5nTGVmdCA9IE1hdGgubWF4KDAsTWF0aC5mbG9vcigod2luZG93LmlubmVyV2lkdGggLSBuZXdXaWR0aCkvMikpICsgInB4IjsKCXRhLnN0eWxlLnBhZGRpbmdSaWdodCA9IE1hdGgubWF4KDAsTWF0aC5mbG9vcigod2luZG93LmlubmVyV2lkdGggLSBuZXdXaWR0aCkvMikpICsgInB4IjsKCSAKCS8vdGVzdC5pbm5lckhUTUwgPSBuZXdIZWlnaHQgKyAiICIgKyB3aW5kb3cuaW5uZXJIZWlnaHQgKyAiICIgKyBmb250U2l6ZTsKCQoJaHJlZiA9ICAiI3Q9IiArIGVuY29kZVVSSUNvbXBvbmVudCh0YS52YWx1ZSk7CglpZiAodGEuc3R5bGUuY29sb3IpIHsKCQlocmVmICs9ICAiO2Y9IiArIGVuY29kZVVSSUNvbXBvbmVudCh0YS5zdHlsZS5jb2xvcik7Cgl9CglpZiAodGEuc3R5bGUuYmFja2dyb3VuZENvbG9yKSB7CgkJaHJlZiArPSAgIjtiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodGEuc3R5bGUuYmFja2dyb3VuZENvbG9yKTsKCX0KCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gaHJlZjsKfQoKZnVuY3Rpb24gc2hvd0JveCgpIHsKCW9wYWNpdHkgPSAxMDA7Cgl3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwoJc2V0T3BhY2l0eSgpOwp9CmZ1bmN0aW9uIGZhZGVPdXQoKSB7CglvcGFjaXR5ICo9IDAuOTg1OwoJaWYgKG9wYWNpdHkgPiAxKSB7CgkJdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCJmYWRlT3V0KCkiLDIwKTsKCX0gZWxzZSB7CgkJb3BhY2l0eSA9IDA7Cgl9CglzZXRPcGFjaXR5KCk7Cn0KZnVuY3Rpb24gc2V0T3BhY2l0eSgpIHsKCWFib3V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFib3V0Iik7CglhYm91dC5zdHlsZS5vcGFjaXR5ID0gb3BhY2l0eS8xMDA7CglhYm91dC5zdHlsZS5maWx0ZXIgPSAiYWxwaGEob3BhY2l0eT0iK01hdGgucm91bmQob3BhY2l0eSkrIikiOwp9CgpmdW5jdGlvbiBwYXJzZUhhc2goKSB7Cgl0YSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZXh0YXJlYSIpOwoJdGEuZm9jdXMoKTsKCgl2YXIgcXVlcnlTdHJpbmcgPSB7fTsKCXdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoCgkJbmV3IFJlZ0V4cCgiKFtePz0mOyNdKykoPShbXiY7XSopKSIsICJnIiksCgkJZnVuY3Rpb24oJDAsICQxLCAkMiwgJDMpIHtxdWVyeVN0cmluZ1skMV0gPSBkZWNvZGVVUklDb21wb25lbnQoJDMpOyB9CgkpOwoJaWYgKHF1ZXJ5U3RyaW5nWyd0J10pIHsKCQl0YS52YWx1ZSA9IHF1ZXJ5U3RyaW5nWyd0J107Cgl9CglpZiAocXVlcnlTdHJpbmdbJ2YnXSkgewoJCXRhLnN0eWxlLmNvbG9yID0gcXVlcnlTdHJpbmdbJ2YnXTsKCX0KCWlmIChxdWVyeVN0cmluZ1snYiddKSB7CgkJdGEuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gcXVlcnlTdHJpbmdbJ2InXTsKCX0KCWFkanVzdCgpOwoJdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCJmYWRlT3V0KCk7IiwxMDAwKTsKCXNldE9wYWNpdHkoKTsKfQoJCmZ1bmN0aW9uIGluaXQoKSB7CglpZiAod2luZG93Lm5hdmlnYXRvci5tb3pBcHBzKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpcmVmb3giKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCX0KCXBhcnNlSGFzaCgpOwp9Cjwvc2NyaXB0Pgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHVzZXItc2NhbGFibGU9bm8iPgo8bWV0YSBuYW1lPSJhcHBsZS1tb2JpbGUtd2ViLWFwcC1jYXBhYmxlIiBjb250ZW50PSJ5ZXMiPgo8bWV0YSBuYW1lPSJmb3JtYXQtZGV0ZWN0aW9uIiBjb250ZW50PSJ0ZWxlcGhvbmU9bm8iPgo8L2hlYWQ+Cjxib2R5IG9ubG9hZD0iaW5pdCgpIiBvbmhhc2hjaGFuZ2U9InBhcnNlSGFzaCgpIiBvbnJlc2l6ZT0iYWRqdXN0KCkiPgo8dGV4dGFyZWEgaWQ9InRleHRhcmVhIiBvbktleVVwPSJhZGp1c3QoKSIgb25wYXN0ZT0iYWRqdXN0KCkiIG9uaW5wdXQ9ImFkanVzdCgpIj46LSk8L3RleHRhcmVhPgo8c3BhbiBpZD0idGVzdCI+PC9zcGFuPgo8ZGl2IGlkPSJhYm91dCIgb25Nb3VzZU92ZXI9InNob3dCb3goKSIgb25Nb3VzZU91dD0iZmFkZU91dCgpIj4KPHA+ClRoaXMgaXMgYW4gb25saW5lLXZlcnNpb24gb2YgdGhlIHByb2dyYW0gPHN0cm9uZz5zY3JlZW4tbWVzc2FnZTwvc3Ryb25nPiBmb3IgTGludXguCjwvcD4KPHAgaWQ9ImZpcmVmb3giIHN0eWxlPSJkaXNwbGF5Om5vbmUiPgpZb3UgY2FuIDxhIGhyZWY9IiMiIG9uY2xpY2s9IndpbmRvdy5uYXZpZ2F0b3IubW96QXBwcy5pbnN0YWxsKCdodHRwOi8vc20ubm9tZWF0YS5kZS9zbS53ZWJhcHAnKSI+aW5zdGFsbCBpdCBhcyBhIEZpcmVGb3ggYXBwPC9hPi4KPC9wPgo8cD4KRm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9yaWdpbmFsIHByb2dyYW0sIHNlZSB3aGF0IDxhIGhyZWY9Imh0dHA6Ly9kZWJhZGF5LmRlYmlhbi5uZXQvMjAwNy8wNy8xOC9zY3JlZW4tbWVzc2FnZS11c2UteW91ci1zY3JlZW4tdG8tY29tbXVuaWNhdGUvIj5EZWItYS1EYXk8L2E+IHdyaXRlcyBhYm91dCBpdC4gWW91IGNhbiBkb3dubG9hZCBpdCBmcm9tIDxhIGhyZWY9Imh0dHA6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL3NpZC9zbSI+RGViaWFuPC9hPiBvciA8YSBocmVmPSJodHRwOi8vZGFyY3Mubm9tZWF0YS5kZS9zY3JlZW4tbWVzc2FnZS8iPmZldGNoIHRoZSBzb3VyY2Vjb2RlPC9hPi4KPC9wPgo8cD4KPHN0cm9uZz5zY3JlZW4tbWVzc2FnZTwvc3Ryb25nPiB3YXMgY3JlYXRlZCBieSA8YSBocmVmPSJodHRwOi8vd3d3LmpvYWNoaW0tYnJlaXRuZXIuZGUvIj5Kb2FjaGltIEJyZWl0bmVyPC9hPi4KSWYgeW91IGxpa2UgaXQsIHRoZW4gPGEgaHJlZj0iaHR0cDovL2ZsYXR0ci5jb20vdGhpbmcvMzMwMTg2L3NjcmVlbi1tZXNzYWdlIiB0YXJnZXQ9Il9ibGFuayI+ZmxhdHRyIHRoaXM8L2E+Lgo8L3A+CjwvZGl2Pgo8L2JvZHk+CjwvaHRtbD4K">screen message</a></h2>
<p>用螢幕展示大字報。</p>
<p>原來是 debian 上的套件 screen message，有人重寫成網頁版本。
可以在瀏覽器中按 F11 進入全螢幕模式。</p>
<p>我是包成 data url 的形式，
但在 anchor 裡直接放 data url 好像不能直接點擊開啟。
但拖曳到書籤或右鍵加入書籤後，點擊還是可以運作。</p>
<h2 id="[map-alpha-to-number-pad]"><a href="map-alpha-to-number-pad.user.js">map alpha to number pad</a></h2>
<p>將鍵盤的 <code>azxcsdfwer</code> 映射成數字鍵 <code>0-9</code> 的腳本。
在設定中的 <code>url-match-map</code> 裡指定在哪些網址中的哪些輸入框裡要啟動映射。
url-match-map 是一個陣列的陣列，
例如 <code>['gholk-enable-map-alpha-to-number-pad', 'input']</code>
就是在網址符合 regexp <code>gholk-enable-map-alpha-to-number-pad</code> 時，
如果輸入框符合 <code>input</code> css 選擇器，就會將 <code>azxcsdfwer</code> 映射為數字鍵。
此外，當然還要把該網址加到油猴腳本的 <code>@match</code> 裡，
或是用選單中的 user-include，在不修改原始標頭的情況下加入。</p>
<h2 id="[e3new-grade]"><a href="javascript:void function () {function userClick(){return alert(&quot;please click the column you want to grade&quot;),new Promise(resolve=>{window.addEventListener(&quot;click&quot;,click=>resolve(click.target),{once:!0})})}function findAcient(node,testSelector){let test;for(test=&quot;string&quot;==typeof testSelector?node=>node.matches(testSelector):testSelector;node;){if(test(node))return node;node=node.parentNode}return null}function getScoreList(){return prompt(&quot;please input score seperated by space&quot;).split(/\s/g)}async function main(){const cell=findAcient(await userClick(),&quot;td&quot;),inputSelector=`td:nth-child(${cell.cellIndex+1}) input`,inputList=findAcient(cell,&quot;table&quot;).querySelectorAll(inputSelector),scoreList=await getScoreList();for(let i=0;i<inputList.length;i++){inputList[i].value=scoreList[i]}}main();}()">e3new grade</a></h2>
<p>一次將全班的成績全部輸入進交通大學 new e3 教學網站中的評分表格。</p>
<ol>
<li><p>進入課程 &gt; 成績管理 &gt; 編輯成績，
網址應該是類似 <a href="https://e3new.nctu.edu.tw/theme/dcpc/grade/report/grader/editgrade.php?id=5566&amp;edit=1">https://e3new.nctu.edu.tw/theme/dcpc/grade/report/grader/editgrade.php?id=5566&amp;edit=1</a> ，
其中 <code>id=5566</code> 換成該課程的 id。</p>
</li>
<li><p>點擊 <em>e3 new grade</em> 小書籤，
會彈出視窗提示使用者點擊要輸入的欄。
按 ok 後，在要評分的欄的任一學生的成績輸入框中點一下。</p>
</li>
<li><p>會再彈出一個輸入框要求輸入全班的成績，
請把全班的成績以一行一個分數，
或用空白分隔也可以，複製後貼到輸入框中，再按確定。</p>
</li>
<li><p>輸入的成績即會依順序填入該欄中的每個輸入框中。</p>
</li>
</ol>
<h2 id="[e3new-entitle]"><a href="e3new-entitle.user.js">e3new entitle</a></h2>
<p>讓 e3 new 的網頁標題顯示課程名稱、分頁名稱等資訊，
這樣就可以用瀏覽器的網址列搜尋快速找到某堂課的頁面。</p>
<h2 id="[paste-to-form-file-小書籤版][paste-to-form-file.bookmarklet.js]"><a href="javascript:void function () {function createFileList(...fileList){const data=new DataTransfer;for(const file of fileList)data.items.add(file);return data.files}function parseHtml(html){return(new DOMParser).parseFromString(html,&quot;text/html&quot;)}async function fetchFile(url){return await new Promise((resolve,reject)=>{GM.xmlHttpRequest({method:&quot;GET&quot;,url:url,responseType:&quot;blob&quot;,onload(xhr){const blob=xhr.response,type=function(xhr){for(const row of xhr.responseHeaders.split(/\n/)){const scan=row.match(/^content-type: ([-_+\w]+)\/([-_+\w]+)/i);if(scan)return console.debug(row),scan[2]}}(xhr);let file;file=type?new File([blob],`drop-image.${type}`,{type:`image/${type}`}):new File([blob],&quot;drop-image&quot;),resolve(file)},onerror(xhr){reject(xhr.statusText)}})})}function putFileIntoForm(fileList){const input=document.querySelector('input[type = &quot;file&quot;]');if(!input)return;console.debug(&quot;fileList:&quot;,...fileList),input.files=fileList;const change=new Event(&quot;change&quot;,{bubbles:!0,cancelable:!1});input.dispatchEvent(change)}document.body.addEventListener(&quot;paste&quot;,paste=>{0!=paste.clipboardData.files.length&amp;&amp;putFileIntoForm(paste.clipboardData.files)}),document.body.addEventListener(&quot;dragover&quot;,over=>over.preventDefault()),document.body.addEventListener(&quot;drop&quot;,async drop=>{drop.preventDefault();const data=drop.dataTransfer;console.debug(&quot;type&quot;,...data.types);let fileList;if(&quot;undefined&quot;!=typeof GM&amp;&amp;0==data.files.length){let urlList;if(~data.types.indexOf(&quot;text/html&quot;)){const dom=parseHtml(data.getData(&quot;text/html&quot;));urlList=dom.querySelectorAll(&quot;img&quot;),console.debug(&quot;query img url&quot;),0==urlList.length&amp;&amp;(console.debug(&quot;no image, query anchor&quot;),urlList=dom.querySelectorAll(&quot;a&quot;)),urlList=Array.from(urlList).map(node=>node.src||node.href)}0==urlList.length&amp;&amp;~data.types.indexOf(&quot;text/plain&quot;)&amp;&amp;(console.debug(&quot;no url found, try plain text&quot;),urlList=data.getData(&quot;text/plain&quot;).split(&quot;\n&quot;).filter(u=>&quot;#&quot;!=u.charAt(0)));try{fileList=await Promise.all(urlList.map(fetchFile))}catch(e){return void console.error(e)}fileList=createFileList(...fileList)}else fileList=drop.dataTransfer.files;console.debug(&quot;file list:&quot;,fileList),putFileIntoForm(fileList)});}()">paste to form file 小書籤版</a></h2>
<p>讓使用者可以用 ctrl-v 貼上或是用拖放檔案的方式把檔案加到表單中的檔案欄位。
此為小書籤版本，在含有上傳檔案的表單欄位 <code>&lt;input type="file"&gt;</code>
的網頁中執行此小書籤後，即可透過 ctrl-c 或其它貼上的方式，
將剪貼簿中的檔案，例如在網頁上右鍵複製的圖片，直接貼到表單中。
或者是用拖放的方式，將電腦中的檔案拖放到網頁中，
檔案即會被載入到表單中的檔案欄位。
如果網頁中含有多於一個的允許貼上檔案的表單，
則會貼上到網頁中第一個表單。</p>
<h2 id="[paste-to-form-file-油猴腳本][paste-to-form-file.user.js]"><a href="paste-to-form-file.user.js">paste to form file 油猴腳本</a></h2>
<p>同上功能，但是油猴腳本 user.js 的版本，
好處是可以直接在指定的網址下執行，不用特別打開書籤欄執行小書籤。
此外相比小書籤版本，油猴版除了拖放電腦中的檔案，
也可以直接拖放其它網頁中的圖片。（由於油猴允許跨網域發送請求。）
預設本腳本只會在 <a href="http://www.google.com/imghp">google 以圖搜圖的頁面</a> 啟用，
如果希望在其它常造訪的網站上啟用，
請在油猴腳本選單中將網站的網址加到腳本的使用者包含或使用者符合中：
油猴選單 (monkey menu) &gt; paste to form file &gt;
使用者指令稿選項 (user script options) &gt;
使用者包含 (include) 或使用者符合 (match) 。</p>
<h2 id="[PTT-精華區網址查詢器][ptt-man-url-lookup]"><a href="javascript:void function () {class PttManUrl{constructor(){return this._constructor(...arguments)}_constructor(){this.domParser=new DOMParser}assert(){return console.assert(...arguments)}parseHtml(html){return this.domParser.parseFromString(html,&quot;text/html&quot;)}parseManPath(path){const list=path.match(/\d+/g).map(x=>Number(x));return this.assert(list.length>0&amp;&amp;!list.some(x=>Number.isNaN(x))),list}async fetchDoc(url){const response=await fetch(url),html=await response.text();return this.parseHtml(html)}async nthInUrl(n,url){return(await this.fetchDoc(url)).querySelectorAll(&quot;.m-ent a&quot;)[n-1].getAttribute(&quot;href&quot;)}boardToUrl(board){return`https://www.ptt.cc/man/${board}/index.html`}static async lookup(board,path){const o=new this;return await o.lookup(board,path)}async lookup(board,pathString){const path=this.parseManPath(pathString);let url=this.boardToUrl(board);for(const n of path){const relative=await this.nthInUrl(n,url);url=new URL(relative,url).href}return url}parseBoardManPath(string){const regexpTail=/\s*\(?([\w-]+)\)?\s*$/,scanTail=string.match(regexpTail);if(scanTail){const board=scanTail[1],path=string.replace(regexpTail,&quot;&quot;);if(!board.slice(1).match(/^[\d-]*$/))return[board,path]}const regexpLead=/^\s*([\w-]{2,})\s*(\.|\s)\s*/,scanLead=string.match(regexpLead);if(scanLead&amp;&amp;&quot;z&quot;!=scanLead[1]&amp;&amp;!/^\d+$/.test(scanLead)){const board=scanLead[1],path=string.replace(regexpLead,&quot;&quot;);if(!board.match(/^\d+$/))return[board,path]}throw new Error(&quot;unknown board format&quot;)}async browserUi(){if(!this.checkCors())return void this.alert(&quot;you need to run this bookmarklet under\nhttps://www.ptt.cc/&quot;);const input=await this.prompt(&quot;please input board name and path&quot;);let board,path;try{[board,path]=this.parseBoardManPath(input)}catch(formatError){board=null}if(!board){let scan;(scan=window.location.href.match(/^https:..www.ptt.cc.(?:man|bbs).([\w-]+)/))&amp;&amp;(board=scan[1],path=input)}if(!board)return void await this.alert(&quot;format error, the path should be one of following:\n8. 8. 2 (PttNewhand)\nz-8-8-2 (PttNewhand)\nz-8-8-2 PttNewhand\nPttNewhand. 8. 8. 2\nPttNewhand 8. 8. 2\nPttNewhand z-8-8-2\nz-8-8-2\n8. 8. 2\n&quot;);let url;for(const done of this.showLoadEffect())try{url=await this.lookup(board,path)}catch(error){url=null,this.alert(error)}return url?this.open(url):void 0}checkCors(){return/^https:..www.ptt.cc(\/|$)/.test(window.location.href)}open(url){return window.open(url)}*showLoadEffect(){const body=document.body,{cursor:cursor,filter:filter}=body.style;Object.assign(body.style,{cursor:&quot;progress&quot;,filter:&quot;brightness(0.8)&quot;}),yield,Object.assign(body.style,{cursor:cursor,filter:filter})}async prompt(question){return prompt(question)}async alert(message){alert(message)}static run(withThis){return withThis(new this)}}&quot;object&quot;==typeof tri?tri.PttManUrl=class extends PttManUrl{async triUi(input){return this.inputFullPath=input,await this.browserUi()}async prompt(question){return this.inputFullPath}async alert(message){await tri.controller.acceptExCmd(&quot;m &quot;+message)}open(url){return url}checkCors(url){return!0}}:&quot;object&quot;==typeof window&amp;&amp;&quot;undefined&quot;==typeof GM&amp;&amp;PttManUrl.run(o=>o.browserUi());}()">PTT 精華區網址查詢器</a></h2>
<p>此小書籤可以把 ptt 以精華區的路徑找出對應精華區網頁版的網址。
由於 cors 的限制，此小書籤需要在 ptt 網頁中使用。
（網址為 <code>https://www.ptt.cc</code> 開頭的網站。）
點擊小書籤後，會出現輸入路徑的對話框，
輸入路徑後開始尋找，找到後會在新分頁打開該網頁。
若無法打開新分頁，請嘗試允許彈出式視窗的顯示。</p>
<p>本定位器接受的路徑有以下型式：</p>
<pre><code>8. 8. 2 (PttNewhand)
z-8-8-2 (PttNewhand)
z-8-8-2 PttNewhand
PttNewhand. 8. 8. 2
PttNewhand 8. 8. 2
PttNewhand z-8-8-2
</code></pre><p>精華區的路徑可以在瀏覽精華區目錄時按 Ctrl-w 顯示，
會取得類似於 z-8-8-2 的格式。
（可以直接把 z-8-8-2 到下一行的看板名稱一起複製，
換行在輸入框中會被替換為空白。）
此時開頭的 z 可省略，z 與數字間的減號也可省略，
減號也可替換為空白。
或是在精華區索引中，以 <code>8. 8. 2</code> 的格式亦可，
此時數字間也可只以空白或點連接。</p>
<p>若是省略看板名稱，定位器會嘗試以目前網址所在看板作為看板名稱嘗試定位：</p>
<pre><code>z-8-8-2
8. 8. 2
</code></pre><h2 id="[儲存頁面-html][download-html.bookmarklet.js]"><a href="javascript:void function () {function doctypeToString(node=document.doctype){return node?&quot;<!DOCTYPE &quot;+node.name+(node.publicId?` PUBLIC &quot;${node.publicId}&quot;`:&quot;&quot;)+(!node.publicId&amp;&amp;node.systemId?&quot; SYSTEM&quot;:&quot;&quot;)+(node.systemId?` &quot;${node.systemId}&quot;`:&quot;&quot;)+&quot;>\n&quot;:&quot;&quot;}function cleanCopy(root){const copy=root.cloneNode(!0);return copy.querySelectorAll(&quot;iframe[src ^= moz-extension&quot;).forEach(e=>e.remove()),fixRelativeUrl(copy),copy}function fixEncode(root){if(&quot;UTF-8&quot;==document.characterSet)return;const list=root.querySelectorAll(&quot;meta[http-equiv=content-type],meta[http-equiv=Content-Type],meta[charset]&quot;);if(0==list.length){if(!confirm(&quot;not UTF-8 and no charset tag found, add one?&quot;))return;const encodeNode=document.createElement(&quot;meta&quot;);encodeNode.setAttribute(&quot;charset&quot;,&quot;utf-8&quot;),encodeNode.dataset.gholkOriginalCharset=&quot;&quot;;const head=root.querySelector(&quot;head&quot;);head?head.prepend(encodeNode):root.prepend(encodeNode)}else list.forEach(encodeNode=>{if(encodeNode.hasAttribute(&quot;charset&quot;)){const original=encodeNode.getAttribute(&quot;charset&quot;);encodeNode.dataset.gholkOriginalCharset=original,encodeNode.setAttribute(&quot;charset&quot;,&quot;utf-8&quot;)}else encodeNode.hasAttribute(&quot;http-equiv&quot;)?(encodeNode.dataset.gholkOriginalContentType=encodeNode.content,encodeNode.content=&quot;text/html; charset=UTF-8&quot;):alert(`unknown error while fix encode node: ${encodeNode.outerHTML}`)})}function fixRelativeUrl(root){let base=root.querySelector(&quot;base&quot;);if(base){const relative=base.getAttribute(&quot;href&quot;);base.dataset.gholkOriginalHref=relative,base.setAttribute(&quot;href&quot;,base.href)}else{(base=document.createElement(&quot;base&quot;)).href=root.baseURI,base.dataset.gholkOriginalHref=&quot;&quot;;let head=root.querySelector(&quot;head&quot;);head?head.prepend(base):root.prepend(base)}}const html=doctypeToString()+cleanCopy(document.documentElement).outerHTML,blob=new Blob([html],{type:&quot;text/html&quot;}),download=document.createElement(&quot;a&quot;);download.download=document.title+&quot;.html&quot;,download.href=URL.createObjectURL(blob),document.body.appendChild(download),download.click(),download.remove(),alert(&quot;cleaning blob?&quot;),URL.revokeObjectURL(blob);}()">儲存頁面 html</a></h2>
<p>將目前網頁的 html 內容儲存為檔案，
主要是用在一些以 javascript 載入內容的網站。
因為直接用 wget curl 拿不到東西，只能在瀏覽器裡打開，
載入完內容後再用小書籤下載下來。</p>
<p>執行後可能會跳出下載視窗，
然後會彈出確認對話框，按確認就會清除暫存的 blob。
下載的檔名預設使用網頁的 title 而不是網址，
因為網址的重名問題有點嚴重。</p>
<h2 id="[prompt-annotate-description]"><a href="javascript:void function(){function main(){var d=document,b=d.body;function $(selector,context){return(context||d).querySelector(selector)}function $$(selector,context){return(context||d).querySelectorAll(selector)}function create(tag,parent){const elm=(parent||b).appendChild(d.createElement(tag));return elm}async function promptUi(title,text=&quot;&quot;){const dialog=document.createElement(&quot;div&quot;);dialog.className=&quot;gholk-prompt-dialog&quot;;const titleNode=create(&quot;h2&quot;,dialog);titleNode.textContent=title;const textarea=create(&quot;textarea&quot;,dialog);textarea.value=text;const docTitle=create(&quot;input&quot;,dialog);docTitle.type=&quot;text&quot;;docTitle.value=document.title;const editable=createContentEditableCheckBox();dialog.appendChild(editable);const ok=create(&quot;button&quot;,dialog);ok.textContent=&quot;ok&quot;;let confirm;let reject;const promise=new Promise((ok,no)=>[confirm,reject]=[ok,no]);ok.onclick=(()=>confirm());const cancel=create(&quot;button&quot;,dialog);cancel.textContent=&quot;cancel&quot;;cancel.onclick=(()=>reject());const download=create(&quot;button&quot;,dialog);download.onclick=(()=>{confirm();setTimeout(downloadHtml,200)});download.textContent=&quot;download&quot;;dialog.addEventListener(&quot;keydown&quot;,e=>{if(e.key==&quot;Enter&quot;&amp;&amp;e.ctrlKey)confirm();else if(e.key==&quot;s&quot;&amp;&amp;e.ctrlKey){e.preventDefault();download.click()}});create(&quot;style&quot;,dialog).textContent=`\n.gholk-prompt-dialog {\n    position: fixed;\n    top: 30%;\n    left: 30%;\n    width: 40%;\n    height: auto;\n    background: white;\n    padding: 1em;\n    z-index: 9999;\n    border: solid 1px;\n    opacity: 0.7;\n}\n.gholk-prompt-dialog h2 {\n    cursor: grab;\n}\n.gholk-prompt-dialog label {\n    display: block;\n}\n.gholk-prompt-dialog textarea {\n    display: block;\n    width: 100%;\n    height: 5em;\n}\n.gholk-prompt-dialog input:not([type]),\n.gholk-prompt-dialog input[type=text] {\n    width: 100%;\n}\n.gholk-prompt-dialog.drag-preview {\n    border-width: 0.3em;\n    opacity: 1;\n}\n.gholk-prompt-dialog.drag-source {\n    opacity: 0.7;\n}\n`;b.appendChild(dialog);enableDragMove(dialog,titleNode);dialog.contentEditable=false;dialog.ondrop=(e=>e.dataTransfer.dropEffect=&quot;copy&quot;);textarea.focus();try{await promise}catch(cancel){return null}finally{dialog.remove()}return{annotate:textarea.value,title:docTitle.value};function createContentEditableCheckBox(){const field=d.createElement(&quot;label&quot;);field.innerHTML='<input type=&quot;checkbox&quot; name=&quot;content-editable-toggle&quot; /> content editable';$(&quot;input&quot;,field).onchange=function(){d.body.contentEditable=this.checked};return field}}function appendAfter(newNode,refNode){const parent=refNode.parentNode;if(refNode.nextSibling)parent.insertBefore(newNode,refNode.nextSibling);else parent.appendChild(newNode)}function findDescription(){const icaseMatch=`\n        property=gholk:annotate name=description\n        property=og:description name=twitter:description\n    `.trim().split(/\s+/).map(r=>r.split(&quot;=&quot;));const metaList=Array.from($$(&quot;meta&quot;));for(const[attr,value]of icaseMatch){const match=metaList.find(e=>new RegExp(value,&quot;i&quot;).test(e.getAttribute(attr)));if(match&amp;&amp;match.content)return match.content}if($(&quot;p&quot;))return $(&quot;p&quot;).textContent;else return&quot;&quot;}async function editDescription(){const description=findDescription();const result=await promptUi(&quot;description&quot;,description);if(result){let annotate=$('meta[property=&quot;gholk:annotate&quot;]');if(!annotate){annotate=document.createElement(&quot;meta&quot;);annotate.setAttribute(&quot;property&quot;,&quot;gholk:annotate&quot;)}annotate.content=result.annotate;document.title=result.title;const first=$(&quot;meta[charset]&quot;)||$(&quot;meta[http-equiv = content-type]&quot;)||$(&quot;meta[http-equiv = Content-Type]&quot;)||d.head.firstChild||d.documentElement.firstChild;appendAfter(annotate,first);const urlTag=createUrlTag();if(urlTag)appendAfter(urlTag,first)}}function createUrlTag(url=window.location.href){if(url.slice(0,5)==&quot;data:&quot;){url=url.replace(/^(data.*?,.{10}).*(.{40})$/,&quot;$1...$2&quot;)}let tag=$('meta[property=&quot;gholk:canonical&quot;]');if(tag){tag.content=url;return null}else{tag=document.createElement(&quot;meta&quot;);tag.setAttribute(&quot;property&quot;,&quot;gholk:canonical&quot;);tag.setAttribute(&quot;content&quot;,url);return tag}}function enableDragMove(container,handle){handle.draggable=true;const allowGlobalDrop=drag=>{drag.preventDefault();drag.dataTransfer.dropEffect=&quot;move&quot;};handle.ondragstart=(start=>{const node=container;const box=node.getBoundingClientRect();start.dataTransfer.setDragImage(node,start.clientX-box.x,start.clientY-box.y);start.dataTransfer.effectAllowed=&quot;move&quot;;window.addEventListener(&quot;dragover&quot;,allowGlobalDrop);window.addEventListener(&quot;drop&quot;,dropOnWindow);node.classList.add(&quot;drag-preview&quot;);node.dataset.dragStartClientXY=`${start.clientX} ${start.clientY}`;setTimeout(()=>{node.classList.add(&quot;drag-source&quot;)},100)});function dropOnWindow(drop){const node=container;const box=node.getBoundingClientRect();const dragStartClientXY=node.dataset.dragStartClientXY.split(&quot; &quot;).map(x=>Number(x));delete node.dataset.dragStartClientXY;node.style.top=drop.clientY-dragStartClientXY[1]+box.y+&quot;px&quot;;node.style.left=drop.clientX-dragStartClientXY[0]+box.x+&quot;px&quot;;node.classList.remove(&quot;drag-preview&quot;);node.classList.remove(&quot;drag-source&quot;)}handle.ondragend=(()=>{window.removeEventListener(&quot;drop&quot;,dropOnWindow);window.removeEventListener(&quot;dragover&quot;,allowGlobalDrop)})}function downloadHtml(){function doctypeToString(node=document.doctype){if(!node)return&quot;&quot;;return&quot;<!DOCTYPE &quot;+node.name+(node.publicId?` PUBLIC &quot;${node.publicId}&quot;`:&quot;&quot;)+(!node.publicId&amp;&amp;node.systemId?&quot; SYSTEM&quot;:&quot;&quot;)+(node.systemId?` &quot;${node.systemId}&quot;`:&quot;&quot;)+&quot;>&quot;+&quot;\n&quot;}function cleanCopy(root){const deep=true;const copy=root.cloneNode(deep);copy.querySelectorAll(&quot;iframe[src ^= moz-extension&quot;).forEach(e=>e.remove());fixRelativeUrl(copy);fixEncode(copy);return copy}function fixEncode(root){if(document.characterSet==&quot;UTF-8&quot;)return;const list=root.querySelectorAll(&quot;meta[http-equiv=content-type],&quot;+&quot;meta[http-equiv=Content-Type],&quot;+&quot;meta[charset]&quot;);if(list.length==0){if(!confirm(&quot;not UTF-8 and no charset tag found, add one?&quot;))return;const encodeNode=document.createElement(&quot;meta&quot;);encodeNode.setAttribute(&quot;charset&quot;,&quot;utf-8&quot;);encodeNode.dataset.gholkOriginalCharset=&quot;&quot;;const head=root.querySelector(&quot;head&quot;);if(head)head.prepend(encodeNode);else root.prepend(encodeNode)}else{list.forEach(encodeNode=>{if(encodeNode.hasAttribute(&quot;charset&quot;)){const original=encodeNode.getAttribute(&quot;charset&quot;);encodeNode.dataset.gholkOriginalCharset=original;encodeNode.setAttribute(&quot;charset&quot;,&quot;utf-8&quot;)}else if(encodeNode.hasAttribute(&quot;http-equiv&quot;)){encodeNode.dataset.gholkOriginalContentType=encodeNode.content;encodeNode.content=&quot;text/html; charset=UTF-8&quot;}else alert(`unknown error while fix encode node: ${encodeNode.outerHTML}`)})}}function fixRelativeUrl(root){let base=root.querySelector(&quot;base&quot;);if(base){const relative=base.getAttribute(&quot;href&quot;);base.dataset.gholkOriginalHref=relative;base.setAttribute(&quot;href&quot;,base.href)}else{base=document.createElement(&quot;base&quot;);base.href=root.baseURI;base.dataset.gholkOriginalHref=&quot;&quot;;let head=root.querySelector(&quot;head&quot;);if(head)head.prepend(base);else root.prepend(base)}}const html=doctypeToString()+cleanCopy(document.documentElement).outerHTML;const blob=new Blob([html],{type:&quot;text/html&quot;});const download=document.createElement(&quot;a&quot;);download.download=document.title+&quot;.html&quot;;download.href=URL.createObjectURL(blob);document.body.appendChild(download);download.click();download.remove();alert(&quot;cleaning blob?&quot;);URL.revokeObjectURL(blob)}editDescription()}function isAppendScriptTag(root=document){if(root.currentScript){return root.currentScript.textContent.match(&quot;isAppendScriptTag&quot;)}else return false}if(isAppendScriptTag()){const script=document.currentScript;setTimeout(()=>{script.remove();main()},800)}else main()}();">prompt annotate description</a></h2>
<p>用來編輯網頁的 meta description 標籤，
可以用來幫網頁加註解，然後 download html，或是用 web scrapebook 下載。
標註的內容會存在 <code>meta[property="gholk:annotate"]</code> 的 content 屬性裡。
會用既有的 description 當作草稿供編輯。</p>
<p>在編輯框中， <code>Ctrl-Enter</code> 可以確認並關閉編輯框，相當於 ok 的按鈕；
<code>Ctrl-s</code> 可以確認並儲存 html，相當於 download 的按鈕，
儲存 html 的功能與上面的 <em>儲存頁面 html</em> 效果相同。</p>
<h2 id="[github-fork-compare]"><a href="javascript:void function () {(async()=>{const aTags=[...document.querySelectorAll(&quot;div.repo a:last-of-type&quot;)].slice(1);for(const aTag of aTags)await fetch(aTag.href).then(x=>x.text()).then(html=>aTag.outerHTML+=`${html.match(/This branch is.*/).pop().replace(&quot;This branch is&quot;,&quot;&quot;).replace(/([0-9]+ commits? ahead)/,'<font color=&quot;#0c0&quot;>$1</font>').replace(/([0-9]+ commits? behind)/,'<font color=&quot;red&quot;>$1</font>')}`).catch(console.error)})();}()">github fork compare</a></h2>
<p>Execute in <code>https://github.com/*/*/network/members</code> to show
each fork is ahead or behind the original repository.</p>
<h2 id="[paste-to-form-file-userscript-version][paste-to-form-file.user.js]"><a href="paste-to-form-file.user.js">paste to form file userscript version</a></h2>
<p>this script allow user to paste or drag file into the file field of form.
you can:</p>
<ul>
<li>right click on image &gt; copy image &gt; ctrl-v on web-page containing form allow upload file</li>
<li>drag image from other web-page and drop on web-page</li>
<li>drag file from desktop or file explorer</li>
<li>drag text which is a url</li>
</ul>
<p>this script is design for general propose.
it should work in any page containing file upload field
( <code>&lt;input type="file"&gt;</code> ).
if you are using any web-page with file upload field,
you can add its url to this script's userscript include/match list,
(monkey menu &gt; <code>paste to form file field</code> &gt; userscript option &gt;
userscript include or userscript match)
so you can paste/drop file into the form.
(this script only run in <a href="http://www.google.com/imghp">google image search</a> default.
you need to manually add other url.)</p>
<h2 id="[msrt-ccf-dice-tool]"><a href="javascript:void function () {const dicer=window[&quot;msrt-ccf-dicer&quot;]={init(){this.inputId=&quot;downshift-0-input&quot;,this.messageSelector=&quot;.MuiListItem-root.MuiListItem-gutters p&quot;,this.diceResultSelector=&quot;span.MuiTypography-colorTextSecondary, span&quot;,this.helpText=&quot;\nexample:\n2D6+3 2D6+1 2D6-3 1D6+2\nalice bob   chard denis\nstaff before last line will be ignored\n...\n#sort\n\nand click `msrt` button\n&quot;,this.addButton()},getText(){return document.getElementById(this.inputId).value},checkFormat(s){const line=s.split(/\n/);return line.length>=3&amp;&amp;line.some(l=>/^#sort/.test(l))},dispatch(node,name){const event=new Event(name,{bubbles:!0});event.isTrust=!0,node.dispatchEvent(event)},setNativeValue(element,value){const valueSetter=Object.getOwnPropertyDescriptor(element,&quot;value&quot;).set,prototype=Object.getPrototypeOf(element),prototypeValueSetter=Object.getOwnPropertyDescriptor(prototype,&quot;value&quot;).set;valueSetter&amp;&amp;valueSetter!==prototypeValueSetter?prototypeValueSetter.call(element,value):valueSetter.call(element,value)},putText(s){const node=document.getElementById(this.inputId);this.setNativeValue(node,s),this.dispatch(node,&quot;change&quot;)},send(){document.querySelector(&quot;button[type=submit]&quot;).click()},sleep:second=>new Promise(wake=>setTimeout(wake,1e3*second)),getLastMessage(){const list=document.querySelectorAll(this.messageSelector);return list[list.length-1]},async waitRoll(){const lastOrigin=this.getLastMessage();for(;;){await this.sleep(1);const last=this.getLastMessage();if(last!=lastOrigin&amp;&amp;this.checkFormat(last.textContent))return last}},parseDiceBracket(node){const text=node.querySelector(this.diceResultSelector).textContent,scan=text.match(/\([\d,+\[\]\-]+\)/g);return scan?scan.map(s=>s.replace(/\[.*\]/,&quot;&quot;)).map(s=>eval(s)):null},normalizeLine(text){const line=text.split(&quot;\n&quot;).map(s=>s.trim());let hide=&quot;&quot;;if(line[line.length-1].match(&quot;#hide&quot;)&amp;&amp;(hide=&quot;S&quot;),line[0].match(&quot; &quot;)){const diceCode=line[0].split(/\s+/).map(d=>`(${d})`).join(&quot;+&quot;);line.unshift(hide+diceCode)}return line},handleError(){alert(&quot;format wrong\n&quot;+this.helpText)},async run(){const text=this.getText().trim();if(!text)throw new Error(&quot;empty input&quot;);if(!this.checkFormat(text))throw new Error(&quot;format wrong&quot;);const line=this.normalizeLine(text),unitList=line[2].split(/\s+/).map(u=>[u]);this.putText(line.join(&quot;\n&quot;)+&quot;\n&quot;),this.send();const roll=await this.waitRoll(),diceResult=this.parseDiceBracket(roll);unitList.forEach((a,i)=>a.push(diceResult[i])),unitList.sort((x,y)=>y[1]-x[1]),this.putText(unitList.map(([n,v])=>`${n}(${n.match(&quot;#S&quot;)?&quot;#&quot;:v})`).join(&quot; > &quot;)+&quot;\n&quot;+line.slice(3,-1).join(&quot;\n&quot;))},addButton(){const b=document.createElement(&quot;button&quot;);b.type=&quot;button&quot;,b.textContent=&quot;msrt&quot;,b.className=&quot;MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textSizeSmall MuiButton-sizeSmall&quot;,b.onclick=(()=>this.run().catch(error=>{alert(String(error)),this.handleError()})),document.querySelector(&quot;button[type=submit]&quot;).parentNode.appendChild(b)}};dicer.init();}()">msrt ccf dice tool</a></h2>
<p>This bookmarklet allow you to roll multiple dices
and sort them in <a href="https://ccfolia.com">Web TRPG platform CCF</a> .</p>
<p>click the bookmarklet in CCF's room,
and there will show up a button named <em>msrt</em>
next to the <em>send</em> button.</p>
<p>In message box, input dice command in first line,
and character names in second line.
both command are splited by space or tab.
multiple space or tab are ignored.
the third and following line will be ignored.
you can input some comment about the dices here.
the last line must contain <code>#sort</code> to indicate
that this is a sort command message.</p>
<pre><code>2D6+3 2D6+1 2D6-3 1D6+2
alice bob   chard denis
battle agile order
first round in basement
#sort
</code></pre><p>then click <em>msrt</em> button,
and this tool, MSRT will format and send the dice command.</p>
<p>the sent command is like:</p>
<pre><code>(2D6+3)+(2D6+1)+(2D6-3)+(1D6+2)
2D6+3 2D6+1 2D6-3 1D6+2
alice bob   chard denis
battle agile order
first round in basement
#sort
 ((2D6+3)+(2D6+1)+(2D6-3)+(1D6+2)) ＞ (8[4,4]+3)+(5[2,3]+1)+(6[2,4]-3)+(1[1]+2) ＞ 23
</code></pre><p>the last line is the result of the dices,
which will only show up after sent.</p>
<p>if the last line is <code>#sort #hide</code>,
the message will not show up to the other players.
this help hiding enemy's abilities detail.</p>
<p>after the dice result show up, MSRT will parse the result and
fill the order in input box.
the comment will also append to the order.</p>
<pre><code>alice(11) &gt; bob(6) &gt; chard(3) &gt; denis(3)
battle agile order
first round in basement
</code></pre><h3 id="中文說明">中文說明</h3>
<p>這是用在 <a href="https://ccfolia.com">網頁 TRPG 平台 ccfolia</a> 的擲骰小工具，
目前可以讓使用者一次丟多個丟多個骰子並排序。
在 ccf 房間中點擊此小書籤後，
會在對話框的發送按鈕旁出現一個 <code>MSRT</code> 按鈕。</p>
<p>要進行排序的話，
在對話框中第一行輸入以空白分隔的數值的組合，
第二行則輸入各組合的名稱，
多個空白會被壓縮為一個。
第三行開始可以輸入任意行的任意文字作為說明，
最行一行則只能有 <code>#sort</code> 關鍵字。
範例：</p>
<pre><code>2D6+3 2D6+1 2D6-3 1D6+2
哈利  榮恩  妙麗  露娜
霍格華茲五年級生決鬥實力
一對一決鬥條件下
#sort
</code></pre><p>接著按下 <code>MSRT</code> 按鈕，
此工具即會把文字調整為如下格式並發送：</p>
<pre><code>(2D6+3)+(2D6+1)+(2D6-3)+(1D6+2)
2D6+3 2D6+1 2D6-3 1D6+2
哈利  榮恩  妙麗  露娜
霍格華茲五年級生決鬥實力
一對一決鬥條件下
#sort
 ((2D6+3)+(2D6+1)+(2D6-3)+(1D6+2)) ＞ (8[4,4]+3)+(5[2,3]+1)+(6[2,4]-3)+(1[1]+2) ＞ 23
</code></pre><p>其中最一行是擲骰結果，是發送後 ccf 系統自動產生的。</p>
<p>若希望隱藏擲骰結果，在最後一行則要改為輸入 <code>#sort #hide</code> ，
這樣就會變成丟只有自己看的到的祕密骰。
ccf 的祕密骰是整則訊息都會隱藏，不只有擲骰結果。</p>
<p>在送出訊息並系統顯示出擲骰結果後，本工具就會依顯示的結果，
在文字輸入框中填入排列好的結果，
使用者可以調整訊息內容或直接送出。
同時作為說明的文字內容也會自動帶入。
範例：</p>
<pre><code>哈利(11) &gt; 榮恩(6) &gt; 妙麗(3) &gt; 靈娜(3)
霍格華茲五年級生決鬥實力
一對一決鬥條件下
</code></pre><h2 id="[google-search-unredirect]"><a href="google-search-unredirect.user.js">google search unredirect</a></h2>
<p>this user script will remove redirect link in google search result page,
so you can copy the link directly on google search result page,
and link to page without redirected by google.</p>
<p>in google search result page, the anchor of result
will be rewrited to a link to google,
then google redirect the link to the destination.
it is troublesome if you want to <em>coyp the link</em> in context menu.
this user script remove these redirect.</p>
<h2 id="[facebook-notify]"><a href="facebook-notify.user.js">facebook notify</a></h2>
<p>this user script will send browser notification
when background facebook web page get notification.
the notification will be sent only if fb is not foreground tab.
if click the button in notification,
userscript will switch to fb tab and open the page.</p>
<h2 id="[happy-html-keyboard-player]"><a href="happy-html-keyboard-player.user.js">happy html keyboard player</a></h2>
<p>an easy html player helper script.
add keyboard short cut for video playing,
including arrow key right/left to seek/backward 5 second,
and space to pause/play.
for mouse, wheel can forward/backward about 5 second every tics,
and click on video can pause/play the video.
you need to add the url to <em>user match</em> of this script
if you want to execute this script in that website.</p>
<p>簡單的播放器腳本，幫 html 的 vedio 標籤加上鍵盤快捷鍵，
包含左右鍵來倒退、前進 5 秒，還有空白鍵來暫停、播放。
滑鼠滾輪也可以倒退、前進大約 5 秒，點擊影片則可以暫停、播放。
本腳本預期可以在任何播放器中執行，
所以你可以將任意網站的網址加入此腳本的 <em>使用者符合</em> 列表中，
以在該網站的影片中加入鍵盤快捷鍵功能；
但某些已經定義過快捷鍵的網頁如 youtube bilibili 中可能會有衝突。
預設會在公視的 <a href="https://www.ptsplus.tv/">ptsplus.tv</a> 中執行，
此外在公視的 <a href="https://www.ptsplus.tv/season/4b572dd5-bdc7-45a6-ba35-accfe9cda3df">勇者動畫系列</a> 中會自動將畫質切為 480P，
因為勇者系列不知道為什麼，如果畫質設 auto 或太高，
都會有非常嚴重的卡頓。</p>
<h2 id="[mastodon-narrow-2-columns-basic]"><a href="mastodon-narrow-2-columns-basic.user.css">mastodon narrow 2 columns basic</a></h2>
<p>Make mastodon web UI in 2 columns, so it works better in narrow window.</p>
<p>This style will split whole page into 2 columns.
The right column is the main stream,
and the left column is split into upper and lower part.
The upper-left is the textarea and the lower-left is the notification area.</p>
<p>You have to add you mastodon instance url to this user style manually.</p>
<h2 id="[tg-note]"><a href="data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxoZWFkPgo8bWV0YSBjaGFyc2V0PSJVVEYtOCI+Cjx0aXRsZT5ub3RlIHRlbXBsYXRlIC0gZ2hvbGs8L3RpdGxlPgo8bWV0YSBwcm9wZXJ0eT0iZ2hvbGs6Y2l0ZSIgY29udGVudD0iaHR0cHM6Ly9naG9say5naXRodWIuaW8vYm9va21hcmtsZXQvdGctbm90ZS5odG1sIj4KPC9oZWFkPgo8Ym9keT4KPG1haW4gY29udGVudGVkaXRhYmxlPSJ0cnVlIgpvbnBhc3RlPSJoYW5kbGVQYXN0ZShldmVudCkiCj48cD5bcF08L3A+CjxwcmU+W3ByZV08L3ByZT4KPC9tYWluPgoKPGFzaWRlIGlkPSJjb250cm9sLXBhbmUiPgo8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkCm9uY2hhbmdlPSJjb250ZW50RWRpdGFibGVUb2dnbGUuY2FsbCh0aGlzKSI+CnRvZ2dsZSBjb250ZW50IGVkaXRhYmxlPC9sYWJlbD4KPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgb25jaGFuZ2U9Imh0bWxUb2dnbGUuY2FsbCh0aGlzKSI+CnNob3cgaHRtbDwvbGFiZWw+CjxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giCm9uY2hhbmdlPSJrZWVwTGluZUJyZWFrVG9nZ2xlLmNhbGwodGhpcykiPgprZWVwIGxpbmUgYnJlYWs8L2xhYmVsPgoKPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2hlY2tlZApuYW1lPSJwYXN0ZS1zbWFydCI+CnNtYXJ0IGVzY2FwZSBodG1sIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBodG1sIHNvdXJjZSBjb2RlIG1vZGU8L2xhYmVsPgoKPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0icGFzdGUtaHRtbCI+CnBhc3RlIGh0bWwgaW4gaHRtbCBzb3VyY2UgY29kZSBtb2RlPC9sYWJlbD4KCjxsYWJlbD5jaXRlIHVybDoKPGlucHV0IHR5cGU9InVybCIgcGxhY2Vob2xkZXI9ImNpdGUgdXJsIgpvbmlucHV0PSJjaXRlVXJsVXBkYXRlLmNhbGwodGhpcykiPgo8L2xhYmVsPgoKPGJ1dHRvbiBvbmNsaWNrPSJpbWFnZUFkZCgpIj5hZGQgaW1hZ2U8L2J1dHRvbj4KPGJ1dHRvbiBvbmNsaWNrPSJkaWdlc3RDaGVja1N1bVNldCgpIj5zaGEyNTY8L2J1dHRvbj4KPC9hc2lkZT4KCjxzdHlsZSBjb250ZW50ZWRpdGFibGU9InRydWUiCj46cm9vdCB7CiAgLyogbGludXgsIG1hYywgKiwgbGludXgsIHdpbmRvd3MsIHdpbmRvd3MsICogKi8KICAtLW1vbm86ICJMaWJlcmF0aW9uIE1vbm8iLCBNb25hY28sICJEZWphVnUgU2FucyBNb25vIiwgIkFub255bW91cyBQcm8iLCBjb25zb2xhcywgY2FzY2FkaWEsIG1vbm9zcGFjZTsKfQpwcmUsIGNvZGUgewogIGZvbnQtZmFtaWx5OiB2YXIoLS1tb25vKTsKfQpib2R5ID4gc3R5bGUsIGJvZHkgPiBzY3JpcHQgewogIGRpc3BsYXk6IGJsb2NrOwogIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKICBjb2xvcjogZ3JheTsKICBtYXJnaW46IDFleDsKICBwYWRkaW5nOiAxZXg7CiAgYm9yZGVyOiBzb2xpZCAxcHg7CiAgZm9udC1mYW1pbHk6IHZhcigtLW1vbm8pOwp9CnRleHRhcmVhLmh0bWwtY29kZSB7CiAgZm9udC1mYW1pbHk6IHZhcigtLW1vbm8pOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTBlbTsKICBkaXNwbGF5OiBibG9jazsKICBvdmVyZmxvdzogYXV0bzsKICBvdXRsaW5lOiBub25lOwogIGJvcmRlcjogbm9uZTsKfQptYWluLmtlZXAtbGluZSA+IHAsIG1haW4gLmtlZXAtbGluZSB7CiAgd2hpdGUtc3BhY2U6IHByZS13cmFwOwp9Ci5oaWRlIHsKICBkaXNwbGF5OiBub25lOwp9CmltZyB7CiAgZGlzcGxheTogYmxvY2s7CiAgbWF4LXdpZHRoOiAxMDAlOwp9CmJsb2NrcXVvdGUgewogIGJvcmRlcjogc29saWQgI0NDQyAxcHg7CiAgYm9yZGVyLWxlZnQ6IHNvbGlkICNDQ0MgMWV4OwogIHBhZGRpbmc6IDAgMWVtOwogIG1hcmdpbi1sZWZ0OiAxZXg7Cn0KbGFiZWwgewogIGRpc3BsYXk6IGZsZXg7Cn0KbWFpbltjb250ZW50ZWRpdGFibGU9dHJ1ZV0gPiAqOm5vdChocix0YWJsZSx1bCxvbCxibG9ja3F1b3RlKTo6YmVmb3JlIHsKICBjb2xvcjogZ3JheTsKICBjb250ZW50OiAnPHg+JzsKICBmb250LWZhbWlseTogdmFyKC0tbW9ubyk7Cn0KbWFpbltjb250ZW50ZWRpdGFibGU9dHJ1ZV0gPiAqOm5vdChocix0YWJsZSx1bCxvbCxibG9ja3F1b3RlKTo6YWZ0ZXIgewogIGNvbG9yOiBncmF5OwogIGNvbnRlbnQ6ICc8Lz4nOwogIGZvbnQtZmFtaWx5OiB2YXIoLS1tb25vKTsKfQpAbWVkaWEgKG1pbi13aWR0aDogNTByZW0pIHsKICAjY29udHJvbC1wYW5lIHsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIGJvdHRvbTogMDsKICAgIHJpZ2h0OiAwOwogICAgYmFja2dyb3VuZDogd2hpdGU7CiAgICBib3JkZXI6IHNvbGlkIDFweDsKICAgIHBhZGRpbmc6IDFlbTsKICB9CiAgYm9keSB7CiAgICBwYWRkaW5nLWJvdHRvbTogMjBlbTsKICB9Cn0KI2NvbnRyb2wtcGFuZSA+IGxhYmVsID4gaW5wdXRbdHlwZT10ZXh0XSwKI2NvbnRyb2wtcGFuZSA+IGxhYmVsID4gaW5wdXRbdHlwZT11cmxdIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXg6IDE7CiAgbWFyZ2luLWxlZnQ6IDFleDsKICBmb250LWZhbWlseTogdmFyKC0tbW9ubyk7CiAgZm9udC12YXJpYW50LW51bWVyaWM6IHNsYXNoZWQtemVybzsKfQptYWluLCAjY29udHJvbC1wYW5lIHsKICBib3JkZXI6IHNvbGlkIDFweDsKICBtYXJnaW46IDFleDsKICBwYWRkaW5nOiAxZXg7Cn0KdGFibGUsIHRoLCB0ZCB7CiAgYm9yZGVyOiBzb2xpZCAxcHg7Cn0KPC9zdHlsZT4KPHNjcmlwdCBjb250ZW50ZWRpdGFibGU9InRydWUiCj52YXIgJGQgPSBkb2N1bWVudCwgJGIgPSAkZC5ib2R5CgpmdW5jdGlvbiAkKHNlbGVjdG9yLCBjb250ZXh0KSB7CiAgICByZXR1cm4gKGNvbnRleHQgfHwgJGQpLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpCn0KZnVuY3Rpb24gJCQoc2VsZWN0b3IsIGNvbnRleHQpIHsKICAgIHJldHVybiBBcnJheS5mcm9tKChjb250ZXh0IHx8ICRkKS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSkKfQoKZnVuY3Rpb24gJGNyZWF0ZSh0YWcsIHBhcmVudCkgewogICAgY29uc3QgZWxtID0gJGQuY3JlYXRlRWxlbWVudCh0YWcpCiAgICBpZiAocGFyZW50KSBwYXJlbnQuYXBwZW5kQ2hpbGQoZWxtKQogICAgcmV0dXJuIGVsbQp9CmZ1bmN0aW9uIGNvbnRlbnRFZGl0YWJsZVRvZ2dsZSgpIHsKICAkKCdtYWluJykuc2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCB0aGlzLmNoZWNrZWQpCiAgaWYgKHRoaXMuY2hlY2tlZCkgdGhpcy5zZXRBdHRyaWJ1dGUoJ2NoZWNrZWQnLCAnJykKICBlbHNlIHRoaXMucmVtb3ZlQXR0cmlidXRlKCdjaGVja2VkJykKfQpmdW5jdGlvbiBrZWVwTGluZUJyZWFrVG9nZ2xlKCkgewogIGlmICh0aGlzLmNoZWNrZWQpIHsKICAgICQoJ21haW4nKS5jbGFzc0xpc3QuYWRkKCdrZWVwLWxpbmUnKQogICAgdGhpcy5zZXRBdHRyaWJ1dGUoJ2NoZWNrZWQnLCAnJykKICB9CiAgZWxzZSB7CiAgICAkKCdtYWluJykuY2xhc3NMaXN0LnJlbW92ZSgna2VlcC1saW5lJykKICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlKCdjaGVja2VkJykKICB9Cn0KZnVuY3Rpb24gaHRtbFRvZ2dsZSgpIHsKICB0b2dnbGUgPSB0aGlzLmNoZWNrZWQKICBjb25zdCB0b0h0bWwgPSB0b2dnbGUKICBjb25zdCBtYWluID0gJCgnbWFpbicpCiAgaWYgKHRvSHRtbCkgewogICAgLy8gVE9ETzogaW5kZW50IGh0bWwKICAgIGNvbnN0IGh0bWwgPSBtYWluLmlubmVySFRNTAogICAgbWFpbi50ZXh0Q29udGVudCA9ICcnCiAgICBjb25zdCBibG9jayA9ICRjcmVhdGUoJ3RleHRhcmVhJywgbWFpbikKICAgIGJsb2NrLnRleHRDb250ZW50ID0gaHRtbAogICAgYmxvY2suY2xhc3NOYW1lID0gJ2h0bWwtY29kZScKICAgIGJsb2NrLm9uaW5wdXQgPSBlID0+IHsKICAgICAgY29uc3Qgbm9kZSA9IGUudGFyZ2V0CiAgICAgIGlmIChub2RlLnNjcm9sbEhlaWdodCA+IG5vZGUub2Zmc2V0SGVpZ2h0KSB7CiAgICAgICAgbm9kZS5zdHlsZS5oZWlnaHQgPSBub2RlLnNjcm9sbEhlaWdodCArICdweCcKICAgICAgfQogICAgfQogICAgYmxvY2sub25pbnB1dCh7dGFyZ2V0OiBibG9ja30pCiAgICBtYWluLnJlbW92ZUF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykKICB9CiAgZWxzZSB7CiAgICBjb25zdCBodG1sID0gJCgnbWFpbj50ZXh0YXJlYScpLnZhbHVlCiAgICBtYWluLmlubmVySFRNTCA9IGh0bWwKICAgIGNvbnRlbnRFZGl0YWJsZVRvZ2dsZS5jYWxsKAogICAgICAkKCdpbnB1dFtvbmNoYW5nZV49Y29udGVudEVkaXRhYmxlVG9nZ2xlXScpCiAgICApCiAgfQp9CmZ1bmN0aW9uIGltYWdlQWRkKCkgewogIGNvbnN0IHN3ID0gJCgnaW5wdXRbb25jaGFuZ2VePWh0bWxUb2dnbGVdJykKICBpZiAoIXN3LmNoZWNrZWQpIHsKICAgIHN3LmNoZWNrZWQgPSB0cnVlCiAgICBzdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpCiAgfQogIGNvbnN0IGJsb2NrID0gJCgnbWFpbj50ZXh0YXJlYScpCiAgYmxvY2sudmFsdWUgKz0gJ1xuPGltZyBzcmM9IiI+XG4nCiAgYmxvY2suZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JykpCiAgYmxvY2suZm9jdXMoKQogIGJsb2NrLnNlbGVjdGlvblN0YXJ0ID0gYmxvY2suc2VsZWN0aW9uRW5kID0gYmxvY2sudmFsdWUubGVuZ3RoIC0gMwp9CgpmdW5jdGlvbiBoYW5kbGVQYXN0ZShlKSB7CiAgaWYgKCFlLnRhcmdldC5tYXRjaGVzKCdtYWluPnRleHRhcmVhLmh0bWwtY29kZTpvbmx5LWNoaWxkJykpIHJldHVybgogIGNvbnN0IGRhdGEgPSBlLmNsaXBib2FyZERhdGEKICBjb25zdCBwYXN0ZUh0bWwgPSAkKCdpbnB1dFtuYW1lPXBhc3RlLWh0bWxdJykuY2hlY2tlZAogIGlmIChwYXN0ZUh0bWwgJiYgfmRhdGEudHlwZXMuaW5kZXhPZigndGV4dC9odG1sJykpIHsKICAgIGUucHJldmVudERlZmF1bHQoKQogICAgY29uc3QgaHRtbCA9IGRhdGEuZ2V0RGF0YSgndGV4dC9odG1sJykKICAgIGluc2VydE9uQ3Vyc29yKGh0bWwpCiAgfQoKICBpZiAoISQoJ2lucHV0W25hbWU9cGFzdGUtc21hcnRdJykuY2hlY2tlZCkgcmV0dXJuCiAgY29uc3QgdGV4dCA9IGRhdGEuZ2V0RGF0YSgndGV4dCcpCiAgaWYgKC9bPD5dLy50ZXN0KHRleHQpIHx8ICEvWyYiJ10vLnRlc3QodGV4dCkpIHJldHVybgoKICBlLnByZXZlbnREZWZhdWx0KCkKICBjb25zdCBub2RlID0gJGNyZWF0ZSgnc3BhbicpCiAgbm9kZS50ZXh0Q29udGVudCA9IHRleHQKICBjb25zdCBlc2NhcGUgPSBub2RlLmlubmVySFRNTAogICAgLnJlcGxhY2UoLyIvZywgJ1x4MjZxdW90OycpCiAgICAucmVwbGFjZSgvJy9nLCAnXHgyNmFwb3M7JykKICBpbnNlcnRPbkN1cnNvcihlc2NhcGUpCn0KZnVuY3Rpb24gaW5zZXJ0T25DdXJzb3IodGV4dCkgewogIGNvbnN0IG5vZGUgPSAkZC5hY3RpdmVFbGVtZW50CiAgbm9kZS5zZXRSYW5nZVRleHQodGV4dCwgbm9kZS5zZWxlY3Rpb25TdGFydCwgbm9kZS5zZWxlY3Rpb25FbmQpCiAgbm9kZS5zZWxlY3Rpb25TdGFydCA9IG5vZGUuc2VsZWN0aW9uRW5kID0KICAgIG5vZGUuc2VsZWN0aW9uU3RhcnQgKyB0ZXh0Lmxlbmd0aAp9CgpmdW5jdGlvbiBoYW5kbGVFbnRlck5vQnIoZXZlbnQpIHsKICBpZiAoZXZlbnQuaXNDb21wb3NpbmcgfHwgZXZlbnQua2V5ICE9ICdFbnRlcicpIHJldHVybgogIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICBpbnNlcnRPbkN1cnNvckNvbnRlbnQoJGQuY3JlYXRlVGV4dE5vZGUoJ1xuJykpCn0KJCQoJ3N0eWxlLHNjcmlwdCcpLmZvckVhY2goZSA9PiBlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVFbnRlck5vQnIpKQoKZnVuY3Rpb24gaW5zZXJ0T25DdXJzb3JDb250ZW50KG5vZGUpIHsKICBjb25zdCBzZWwgPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKQogIGNvbnN0IHJhbmdlID0gc2VsLmdldFJhbmdlQXQoMCkKICByYW5nZS5kZWxldGVDb250ZW50cygpCiAgcmFuZ2UuaW5zZXJ0Tm9kZShub2RlKQogIHJhbmdlLmNvbGxhcHNlKCkKfQoKZnVuY3Rpb24gY2l0ZVVybFVwZGF0ZSgpIHsKICBjb25zdCBtZXRhID0gJCgnbWV0YVtwcm9wZXJ0eT0iZ2hvbGs6Y2l0ZSJdJykKICBtZXRhLmNvbnRlbnQgPSB0aGlzLnZhbHVlCiAgdGhpcy5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgdGhpcy52YWx1ZSkKfQphc3luYyBmdW5jdGlvbiBkaWdlc3RDaGVja1N1bVNldCgpIHsKICBjb25zdCBodG1sID0gJCgnaHRtbCcpLm91dGVySFRNTAogIGNvbnN0IHN1bSA9IGF3YWl0IGRpZ2VzdENoZWNrU3VtKGh0bWwpCiAgY29uc3QgaGV4ID0gYnVmZmVyVG9IZXgoc3VtKQogIGNvbnN0IGZpZWxkID0gJCgnaW5wdXRbb25pbnB1dF49ImNpdGVVcmxVcGRhdGUiXScpCiAgZmllbGQudmFsdWUgKz0gYD9zaGEyNTY9JHtoZXh9YAogIGNpdGVVcmxVcGRhdGUuY2FsbChmaWVsZCkKfQpmdW5jdGlvbiBkaWdlc3RDaGVja1N1bSh0ZXh0KSB7CiAgY29uc3QgZW5jID0gbmV3IFRleHRFbmNvZGVyKCkKICBjb25zdCBkYXRhID0gZW5jLmVuY29kZSh0ZXh0KQogIHJldHVybiBjcnlwdG8uc3VidGxlLmRpZ2VzdCgnU0hBLTI1NicsIGRhdGEpCn0KZnVuY3Rpb24gYnVmZmVyVG9IZXgoYnVmZmVyKSB7CiAgY29uc3QgdTggPSBuZXcgVWludDhBcnJheShidWZmZXIpCiAgcmV0dXJuIEFycmF5LmZyb20odTgpCiAgICAubWFwKHUgPT4gKCcwJyArIHUudG9TdHJpbmcoMTYpKS5zbGljZSgtMikudG9VcHBlckNhc2UoKSkKICAgIC5qb2luKCcnKQp9CiQkKCdpbnB1dCcpLmZvckVhY2goZSA9PiB7CiAgc3dpdGNoIChlLnR5cGUpIHsKICAgIGNhc2UgJ2NoZWNrYm94JzoKICAgIGUuY2hlY2tlZCA9IGUuZGVmYXVsdENoZWNrZWQKICAgIGJyZWFrCiAgICAKICAgIGNhc2UgJ3VybCc6CiAgICBjYXNlICd0ZXh0JzoKICAgIGUudmFsdWUgPSBlLmRlZmF1bHRWYWx1ZQogIH0KfSkKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=">tg note</a></h2>
<p>A basic html editor to compose rich text.
Designed to store article snippets with <a href="#%5Bprompt-annotate-description%5D">annotate</a> .</p>
</main>




</body></html>