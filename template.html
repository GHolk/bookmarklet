<!DOCTYPE html>
<html lang="zh-TW" prefix="og: http://ogp.me/ns#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">

<title></title>

<meta name="author" property="og:article:author" content="gholk">
<meta name="copyright" content="GPLv3+">
<meta name="generator" content="mark-dd">

<meta name="date" property="og:article:public_time" content="">
<meta name="keywords" property="og:article:tag"
content="bookmarklet, javascript, tool, greasemonkey, user-script, data-url">
<meta name="description" property="og:description" content="">

<link rel="alternate" type="text/html" href="https://g0v.social/@gholk" title="在 fediverse 上討論" id="active-pub-thread">
<link rel="alternate" type="application/atom+xml"
      href="https://github.com/GHolk/bookmarklet/commits/master.atom">

<link rel="icon" type="image/png" href="../ext/icon.png">
<link rel="apple-touch-icon" type="image/png" href="../ext/icon.png">
<link rel="webmention" href="https://webmention.io/gholk.github.io/webmention">
<link rel="pingback" href="https://webmention.io/gholk.github.io/xmlrpc">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  :target {
      background: yellow;
  }
</style>

</head>
<body>
<main>
</main>

<script class="template">
  $('title').text($('h1').text())
  $('meta[name=date]').attr('content', new Date().toISOString())
  $('meta[name=description]').attr('content', $('p').first().text())
  $('html').attr('lang', dd.option.language.match(/^[^.]+/)[0])
  $('p>img').each((i, e) => {
      const $e = $(e)
      const $p = $e.parent()
      if ($(e).parent().contents().length == 1) $p.replaceWith($e)
  })
  $('head').append($('main style'))
  $('*[id]').each((i, e) => {
      let id = $(e).attr("id")
      $(e).attr('id', idBracketClean(id))
  })
  function idBracketClean(id) {
      if (id.indexOf("[") == -1) return id
      const scan = id.match(/\[[^\]]*\]/)
      return scan[0].slice(1, -1)
  }
  $.currentScript.after(
      $('<script>').html(idBracketClean.toString())
  )
</script>

<script>
  if (window.location.hash) {
      const h = decodeURIComponent(window.location.hash.slice(1))
      if (h.indexOf('[') != -1) {
          // in firefox, before the window load event,
          // assign id does not scroll and trigger the :target selector.
          setTimeout(() => window.location.hash = idBracketClean(h), 300)
      }
  }
</script>

</body></html>
